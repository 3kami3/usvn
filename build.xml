<?xml version="1.0"?>

<project name="USVN" basedir="." default="all">
  <property name="docdir" value="apidocs" override="true" />
  <property name="srcdir" value="." override="true" />
  <property name="testdir" value="tests" override="true" />
  <property name="reportdir" value="report" override="true" />


  <target name="all">
    <phingcall target="test" />
    <phingcall target="doc" />
    <phingcall target="tar" />
  </target>

  <target name="test">
    <delete file="${reportdir}/*" />
    <mkdir dir="${reportdir}" />
    <phpunit2 haltonfailure="true" printsummary="true">
      <batchtest>
        <fileset dir="${testdir}">
          <include name="**/test_*.php"/>
        </fileset>
      </batchtest>
      <formatter type="xml" todir="${reportdir}" outfile="logfile.xml"/>
    </phpunit2>

    <phpunit2report infile="${reportdir}/logfile.xml"
                   styledir="${testdir}"
                   format="frames"
                   todir="${reportdir}"/>
  </target>

  <target name="doc">
     <delete dir="${docdir}" />
     <mkdir dir="${docdir}" />
     <phpdoc title="USVN Documentation" destdir="${docdir}" sourcepath="${srcdir}" output="HTML:Smarty:PHP"/>
  </target>

  <target name="tar">
    <delete file="usvn.tgz" />
    <tar destfile="usvn.tgz" compression="gzip">
      <fileset dir="${srcdir}">
        <include name="*.php" />
        <include name="${testdir}/*.php" />
        <include name="*.txt" />
        <include name="*.xml" />
      </fileset>
    </tar>
  </target>
</project>